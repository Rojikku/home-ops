---
apiVersion: stash.appscode.com/v1alpha1
kind: Repository
metadata:
  name: b2-repo-sonarr
  namespace: sonarr
spec:
  backend:
    b2:
      bucket: ${B2_BUCKET}
      prefix: /stash/sonarr
    storageSecretName: b2-secrets
---
apiVersion: stash.appscode.com/v1beta1
kind: BackupConfiguration
metadata:
  name: sonarr-backup
  namespace: vpn
  labels:
    setGateway: false
spec:
  repository:
    name: b2-repo-sonarr
  schedule: "30 02 * * *"
  target:
    alias: sonarr
    ref:
      apiVersion: apps/v1
      kind: Deployment
      name: sonarr
    volumeMounts:
      - name: config
        mountPath: /config
    paths:
      - /config/Backups
  retentionPolicy:
    name: 'keep-last-7'
    keepLast: 7
    prune: true
